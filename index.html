<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Drag Force Simulation</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        .slider-container, .input-container {
            margin: 10px;
        }
        .chart-container {
            width: 90%;
            max-width: 900px;
            margin: auto;
        }
        canvas {
            width: 100% !important;
            height: auto !important;
            max-height: 80vh;
        }
    </style>
</head>
<body>

    <h2>Water Drag Force Simulation</h2>
    <p>Adjust the sliders and ship parameters to see how drag forces compare.</p>

    <!-- Sliders for Adjustable Drag Force -->
    <div class="slider-container">
        <label>Drag Coefficient (Cd): <span id="cdValue">0.8</span></label>
        <input type="range" id="cdSlider" min="0.1" max="1" step="0.01" value="0.8">
    </div>

    <div class="slider-container">
        <label>Front Surface Area (m²): <span id="areaValue">1.0</span></label>
        <input type="range" id="areaSlider" min="0.1" max="5.0" step="0.05" value="1.0">
    </div>

    <div class="slider-container">
        <label>Velocity (knots): <span id="velocityValue">10.0</span></label>
        <input type="range" id="velocitySlider" min="0" max="15" step="0.1" value="10">
    </div>

    <div class="slider-container">
        <label>Number of Units: <span id="unitValue">10</span></label>
        <input type="number" id="unitInput" min="1" max="100" step="1" value="10">
    </div>

    <h3>Total Drag Force: <span id="dragForce">0</span> MN</h3>

    <hr>

    <!-- Input Fields for Clean Ship Drag Force Calculation -->
    <h3>Clean Ship Drag Force Calculation</h3>
    <div class="input-container">
        <label>Ship Length (m): <input type="number" id="shipLength" min="1" max="500" step="0.1" value="100"></label>
    </div>
    <div class="input-container">
        <label>Ship Width (m): <input type="number" id="shipWidth" min="1" max="100" step="0.1" value="20"></label>
    </div>
    <div class="input-container">
        <label>Ship Drag Height (m): <input type="number" id="shipHeight" min="1" max="50" step="0.1" value="5"></label>
    </div>

    <h3>Clean Ship Drag Force: <span id="shipDragForce">0</span> MN</h3>

    <!-- Graph Container -->
    <div class="chart-container">
        <canvas id="dragChart"></canvas>
    </div>

    <script>
        // Constants
        const rho = 1025; // Water density (kg/m³)
        const knotToMps = 1852 / 3600; // Conversion factor from knots to m/s

        // Get input elements
        const cdSlider = document.getElementById("cdSlider");
        const areaSlider = document.getElementById("areaSlider");
        const velocitySlider = document.getElementById("velocitySlider");
        const unitInput = document.getElementById("unitInput");

        const shipLengthInput = document.getElementById("shipLength");
        const shipWidthInput = document.getElementById("shipWidth");
        const shipHeightInput = document.getElementById("shipHeight");

        // Get display elements
        const cdValue = document.getElementById("cdValue");
        const areaValue = document.getElementById("areaValue");
        const velocityValue = document.getElementById("velocityValue");
        const unitValue = document.getElementById("unitValue");
        const dragForceDisplay = document.getElementById("dragForce");
        const shipDragForceDisplay = document.getElementById("shipDragForce");

        // Function to calculate drag force in Mega Newtons (MN)
        function calculateDrag(Cd, A, v) {
            return (0.5 * Cd * rho * A * v ** 2) / 1e6; // Divide by 10^6 to get MN
        }

        // Initialize Chart.js
        const ctx = document.getElementById("dragChart").getContext("2d");
        let dragChart = new Chart(ctx, {
            type: "line",
            data: {
                labels: Array.from({ length: 16 }, (_, i) => i), // Time from 0 to 15 seconds
                datasets: [
                    {
                        label: "Total Drag Force (MN)",
                        data: [],
                        borderColor: "blue",
                        backgroundColor: "rgba(0, 0, 255, 0.2)",
                        fill: true,
                        pointRadius: 5,
                        pointHoverRadius: 8,
                    },
                    {
                        label: "Clean Ship Drag Force (MN)",
                        data: [],
                        borderColor: "red",
                        backgroundColor: "rgba(255, 0, 0, 0.2)",
                        fill: true,
                        pointRadius: 5,
                        pointHoverRadius: 8,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { 
                        title: { display: true, text: "Time (s)" }
                    },
                    y: { 
                        title: { display: true, text: "Drag Force (MN)" },
                        beginAtZero: false, // Don't start the y-axis from zero
                        min: 0,  // Set a reasonable minimum for better readability
                        ticks: {
                            stepSize: 1,  // Adjust the step size for better tick intervals
                        }
                    }
                }
            }
        });

        function updateSimulation() {
            // Get values from sliders
            const Cd = parseFloat(cdSlider.value);
            const A = parseFloat(areaSlider.value);
            const vKnots = parseFloat(velocitySlider.value); // Velocity in knots
            let units = parseInt(unitInput.value);

            // Convert velocity from knots to m/s
            const vMps = vKnots * knotToMps;
            velocityValue.textContent = vKnots.toFixed(2);

            // Prevent invalid unit values
            if (units < 1) units = 1;

            // Calculate robot's drag force (robot drag = robot drag force)
            const robotDragForce = calculateDrag(Cd, A, vMps) * units;
            dragForceDisplay.textContent = robotDragForce.toFixed(6);

            // Get ship dimensions
            const shipLength = parseFloat(shipLengthInput.value);
            const shipHeight = parseFloat(shipHeightInput.value);

            // Calculate clean ship frontal area and drag force
            const shipArea = shipLength * shipHeight;
            const shipDragForce = calculateDrag(Cd, shipArea, vMps);
            shipDragForceDisplay.textContent = shipDragForce.toFixed(6);

            // Calculate total drag force (sum of robot's drag force and clean ship drag force)
            const totalDragForce = robotDragForce + shipDragForce;
            dragForceDisplay.textContent = totalDragForce.toFixed(6);

            // Update chart data
            dragChart.data.datasets[0].data = Array(16).fill(totalDragForce);
            dragChart.data.datasets[1].data = Array(16).fill(shipDragForce);

            dragChart.update();
        }

        // Event listeners
        document.querySelectorAll("input").forEach(input => input.addEventListener("input", updateSimulation));

        // Initial update
        updateSimulation();
    </script>

</body>
</html>
