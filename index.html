<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Drag Force Simulation</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        .slider-container {
            margin: 10px;
        }
        .chart-container {
            width: 90%;
            max-width: 900px;
            margin: auto;
        }
        canvas {
            width: 100% !important;
            height: auto !important;
            max-height: 80vh;
        }
    </style>
</head>
<body>

    <h2>Water Drag Force Simulation</h2>
    <p>Adjust the sliders to compare robot cleaning drag vs. biofouling growth over time.</p>

    <!-- Robot Inputs -->
    <div class="slider-container">
        <label>Robot Drag Coefficient (Cd): <span id="cdValue">0.8</span></label>
        <input type="range" id="cdSlider" min="0.1" max="1" step="0.01" value="0.8">
    </div>

    <div class="slider-container">
        <label>Robot Surface Area (m²): <span id="areaValue">1.0</span></label>
        <input type="range" id="areaSlider" min="0.1" max="5.0" step="0.05" value="1.0">
    </div>

    <div class="slider-container">
        <label>Robot Velocity (m/s): <span id="velocityValue">10.0</span></label>
        <input type="range" id="velocitySlider" min="0" max="15" step="0.05" value="10">
    </div>

    <div class="slider-container">
        <label>Number of Robots: <span id="unitValue">10</span></label>
        <input type="number" id="unitInput" min="1" max="100" step="1" value="10">
    </div>

    <!-- Ship Inputs -->
    <h3>Ship Parameters (for Biofouling Calculation)</h3>

    <div class="slider-container">
        <label>Ship Length (m): <span id="shipLengthValue">100</span></label>
        <input type="range" id="shipLengthSlider" min="10" max="400" step="1" value="100">
    </div>

    <div class="slider-container">
        <label>Ship Width (m): <span id="shipWidthValue">20</span></label>
        <input type="range" id="shipWidthSlider" min="5" max="80" step="1" value="20">
    </div>

    <div class="slider-container">
        <label>Ship Draft (m): <span id="shipDraftValue">10</span></label>
        <input type="range" id="shipDraftSlider" min="2" max="20" step="1" value="10">
    </div>

    <div class="slider-container">
        <label>Days Without Cleaning: <span id="daysValue">0</span></label>
        <input type="range" id="daysSlider" min="0" max="100" step="1" value="0">
    </div>

    <!-- Separate Total Drag Forces -->
    <h3>Total Drag Force</h3>
    <p><strong>Robot Drag Force:</strong> <span id="robotDragForce">0</span> N</p>
    <p><strong>Biofouling Drag Force (Additional):</strong> <span id="biofoulingDragForce">0</span> N</p>

    <!-- Graph Container -->
    <div class="chart-container">
        <canvas id="dragChart"></canvas>
    </div>

    <script>
        // Constants
        const rho = 1025; // Water density (kg/m³)
        const A_BIO = 0.075; // Empirical constant for biofouling roughness
        const B_BIO = 0.9; // Empirical constant for friction increase
        const biofoulingGrowthPerDay = 0.15 / 1000; // Biofouling growth rate in meters per day (0.15mm/day)

        // Function to calculate ship wetted surface area
        function calculateShipArea(L, W, D) {
            return 1.7 * L * D + W * L;
        }

        // Function to calculate drag force per robot
        function calculateDrag(Cd, A, v) {
            return 0.5 * Cd * rho * A * v ** 2;
        }

        // Function to calculate additional biofouling drag force over time
        function calculateBiofoulingDrag(A_ship, v, days, L, W) {
            // Biofouling growth in meters
            const biofoulingHeight = biofoulingGrowthPerDay * days;

            // Additional wetted area due to biofouling
            const A_bio = L * W * biofoulingHeight;

            // Drag coefficient adjustment due to biofouling
            const delta_CF = A_BIO * Math.pow(biofoulingHeight / A_ship, B_BIO);

            // Additional drag force due to biofouling
            return 0.5 * rho * v ** 2 * A_bio * delta_CF;
        }

        // Initialize Chart.js
        const ctx = document.getElementById("dragChart").getContext("2d");
        let dragChart = new Chart(ctx, {
            type: "line",
            data: {
                labels: Array.from({ length: 101 }, (_, i) => i),
                datasets: [
                    { label: "Robot Drag Force (N)", data: [], borderColor: "blue", backgroundColor: "rgba(0, 0, 255, 0.2)", fill: true },
                    { label: "Biofouling Drag Force (N)", data: [], borderColor: "red", backgroundColor: "rgba(255, 0, 0, 0.2)", fill: true }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });

        function updateSimulation() {
            // Get values from inputs
            const Cd = parseFloat(cdSlider.value);
            const A = parseFloat(areaSlider.value);
            const v = parseFloat(velocitySlider.value);
            const units = parseInt(unitInput.value);
            const days = parseInt(daysSlider.value);
            const L = parseFloat(shipLengthSlider.value);
            const W = parseFloat(shipWidthSlider.value);
            const D = parseFloat(shipDraftSlider.value);
            const A_ship = calculateShipArea(L, W, D);

            // Calculate drag force for robot
            const robotDrag = calculateDrag(Cd, A, v) * units;

            // Calculate additional biofouling drag force
            const biofoulingDrag = calculateBiofoulingDrag(A_ship, v, days, L, W);

            // Update displayed values
            document.getElementById("cdValue").textContent = Cd;
            document.getElementById("areaValue").textContent = A;
            document.getElementById("velocityValue").textContent = v;
            document.getElementById("unitValue").textContent = units;
            document.getElementById("daysValue").textContent = days;
            document.getElementById("shipLengthValue").textContent = L;
            document.getElementById("shipWidthValue").textContent = W;
            document.getElementById("shipDraftValue").textContent = D;

            // Update displayed drag forces
            document.getElementById("robotDragForce").textContent = robotDrag.toFixed(2);
            document.getElementById("biofoulingDragForce").textContent = biofoulingDrag.toFixed(2);

            // Update chart data
            dragChart.data.datasets[0].data = Array.from({ length: 101 }, (_, i) => calculateDrag(Cd, A, v) * units);
            dragChart.data.datasets[1].data = Array.from({ length: 101 }, (_, i) => calculateBiofoulingDrag(A_ship, v, i, L, W));
            dragChart.update();
        }

        // Event listeners for inputs
        sliders.forEach(slider => slider.addEventListener("input", updateSimulation));
        updateSimulation();
    </script>

</body>
</html>
