<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ship Drag Force Simulation with Biofouling</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        .slider-container {
            margin: 10px;
        }
        .chart-container {
            width: 90%;
            max-width: 900px;
            margin: auto;
        }
        canvas {
            width: 100% !important;
            height: auto !important;
            max-height: 80vh;
        }
    </style>
</head>
<body>

    <h2>Ship Drag Force Simulation with Biofouling</h2>
    <p>Adjust the sliders to see how drag force changes over time, considering biofouling growth.</p>

    <!-- Sliders for ship -->
    <div class="slider-container">
        <label>Ship Length (m): <span id="lengthValue">20</span></label>
        <input type="range" id="lengthSlider" min="10" max="500" step="10" value="200">
    </div>

    <div class="slider-container">
        <label>Ship Width (m): <span id="widthValue">10</span></label>
        <input type="range" id="widthSlider" min="5" max="100" step="1" value="20">
    </div>

    <div class="slider-container">
        <label>Drag Height (m): <span id="heightValue">5</span></label>
        <input type="range" id="heightSlider" min="1" max="20" step="1" value="10">
    </div>

    <div class="slider-container">
        <label>Velocity (knots): <span id="velocityValue">10</span></label>
        <input type="range" id="velocitySlider" min="0" max="30" step="1" value="10">
    </div>

    <div class="slider-container">
        <label>Biofouling Growth Rate (r): <span id="growthRateValue">0.1</span></label>
        <input type="range" id="growthRateSlider" min="0" max="0.5" step="0.01" value="0.1">
    </div>

    <h3>Total Drag Force: <span id="dragForce">0</span> N</h3>

    <!-- Graph Container -->
    <div class="chart-container">
        <canvas id="dragChart"></canvas>
    </div>

    <script>
        // Constants
        const rho = 1025; // Water density (kg/mÂ³), always assumed to be 1025
        const dmax = 0.045; // Maximum fouling thickness (m)
        const f0 = 0; // Initial fouling thickness (m), assumed 0
        const r = 0.1; // Fouling growth rate (per day)

        // Get input elements
        const lengthSlider = document.getElementById("lengthSlider");
        const widthSlider = document.getElementById("widthSlider");
        const heightSlider = document.getElementById("heightSlider");
        const velocitySlider = document.getElementById("velocitySlider");
        const growthRateSlider = document.getElementById("growthRateSlider");

        // Get display elements
        const lengthValue = document.getElementById("lengthValue");
        const widthValue = document.getElementById("widthValue");
        const heightValue = document.getElementById("heightValue");
        const velocityValue = document.getElementById("velocityValue");
        const growthRateValue = document.getElementById("growthRateValue");
        const dragForceDisplay = document.getElementById("dragForce");

        // Function to calculate ship drag force
        function calculateShipDrag(L, W, H, v) {
            // Cross-sectional area is the width * drag height
            const A = W * H;
            return 0.5 * 0.8 * rho * A * v ** 2;  // Cd for ship is 0.8
        }

        // Function to calculate fouling thickness based on logistic growth
        function calculateFoulingThickness(t) {
            return dmax / (1 + (dmax / f0 - 1) * Math.exp(-r * t));
        }

        // Initialize Chart.js
        const ctx = document.getElementById("dragChart").getContext("2d");
        let dragChart = new Chart(ctx, {
            type: "line",
            data: {
                labels: Array.from({ length: 16 }, (_, i) => i), // X-axis: Time (days)
                datasets: [{
                    label: "Ship Drag Force with Biofouling (N)",
                    data: [],
                    borderColor: "green",
                    backgroundColor: "rgba(0, 255, 0, 0.2)",
                    fill: true,
                    pointRadius: 5,
                    pointHoverRadius: 8,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        enabled: true,
                        mode: "nearest",
                        intersect: false,
                        callbacks: {
                            label: function (context) {
                                return `Ship Drag Force with Biofouling: ${context.raw.toFixed(2)} N`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: "Time (Days)" },
                        min: 0,
                        max: 15,
                        ticks: { stepSize: 1 }
                    },
                    y: {
                        title: { display: true, text: "Drag Force (N)" },
                        beginAtZero: false
                    }
                }
            }
        });

        // Function to update the simulation
        function updateSimulation() {
            // Get values from inputs
            const L = parseFloat(lengthSlider.value);
            const W = parseFloat(widthSlider.value);
            const H = parseFloat(heightSlider.value);
            const vKnots = parseFloat(velocitySlider.value);

            // Convert velocity from knots to m/s
            const v = vKnots * 0.514444;  // 1 knot = 0.514444 m/s

            // Update displayed values
            lengthValue.textContent = L.toFixed(2);
            widthValue.textContent = W.toFixed(2);
            heightValue.textContent = H.toFixed(2);
            velocityValue.textContent = vKnots.toFixed(2);
            growthRateValue.textContent = r.toFixed(2);

            // Calculate drag force for the clean ship
            const shipDragForce = calculateShipDrag(L, W, H, v);

            // Calculate fouling thickness at each time step
            let foulingData = Array.from({ length: 16 }, (_, i) => {
                let foulingThickness = calculateFoulingThickness(i);
                // Update drag force with fouling
                const A_fouled = (W * H) + (L * H) + (L * W);  // Effective area for fouling
                const fouledDragForce = 0.5 * 0.8 * rho * A_fouled * v ** 2;
                return fouledDragForce;
            });

            // Update chart data
            dragChart.data.datasets[0].data = foulingData;
            dragChart.update();
        }

        // Event listeners for sliders and input
        lengthSlider.addEventListener("input", updateSimulation);
        widthSlider.addEventListener("input", updateSimulation);
        heightSlider.addEventListener("input", updateSimulation);
        velocitySlider.addEventListener("input", updateSimulation);
        growthRateSlider.addEventListener("input", updateSimulation);

        // Initial update
        updateSimulation();
    </script>

</body>
</html>
