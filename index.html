<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Drag Force Simulation</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        .slider-container {
            margin: 10px;
        }
        .chart-container {
            width: 90%;
            max-width: 900px;
            margin: auto;
        }
        canvas {
            width: 100% !important;
            height: auto !important;
            max-height: 80vh;
        }
    </style>
</head>
<body>

    <h2>Water Drag Force Simulation</h2>
    <p>Adjust the sliders to see how drag force changes in real-time.</p>

    <!-- Sliders for robot inputs -->
    <div class="slider-container">
        <label>Drag Coefficient (Cd) - Robot: <span id="cdValue">0.8</span></label>
        <input type="range" id="cdSlider" min="0.1" max="1" step="0.01" value="0.8">
    </div>

    <div class="slider-container">
        <label>Front Surface Area (m²) - Robot: <span id="areaValue">1.0</span></label>
        <input type="range" id="areaSlider" min="0.1" max="5.0" step="0.05" value="1.0">
    </div>

    <div class="slider-container">
        <label>Speed (knots): <span id="velocityValue">10.0</span></label>
        <input type="range" id="velocitySlider" min="0" max="15" step="0.1" value="10">
    </div>

    <div class="slider-container">
        <label>Number of Units - Robot: <span id="unitValue">10</span></label>
        <input type="number" id="unitInput" min="1" max="100" step="1" value="10">
    </div>

    <!-- Sliders for ship inputs -->
    <div class="slider-container">
        <label>Ship Length (m): <span id="lengthValue">100</span></label>
        <input type="number" id="lengthInput" min="1" max="1000" step="1" value="100">
    </div>

    <div class="slider-container">
        <label>Ship Width (m): <span id="widthValue">30</span></label>
        <input type="number" id="widthInput" min="1" max="1000" step="1" value="30">
    </div>

    <div class="slider-container">
        <label>Drag Height (m): <span id="heightValue">5</span></label>
        <input type="number" id="heightInput" min="1" max="100" step="1" value="5">
    </div>

    <h3>Total Drag Force: <span id="dragForce">0</span> N</h3>

    <!-- Graph Container -->
    <div class="chart-container">
        <canvas id="dragChart"></canvas>
    </div>

    <script>
        // Constants
        const rho = 1025; // Water density (kg/m³)
        const maxFoulingThickness = 0.045; // Maximum fouling thickness in meters (45mm)
        const Cd_clean = 0.003; // Clean ship drag coefficient
        const Cd_biofouledMax = 0.01; // Maximum drag coefficient when fully biofouled (e.g., for a heavily biofouled hull)
        const biofoulingRate = 0.01; // Biofouling rate constant for logistic growth

        // Get input elements
        const cdSlider = document.getElementById("cdSlider");
        const areaSlider = document.getElementById("areaSlider");
        const velocitySlider = document.getElementById("velocitySlider");
        const unitInput = document.getElementById("unitInput");

        const lengthInput = document.getElementById("lengthInput");
        const widthInput = document.getElementById("widthInput");
        const heightInput = document.getElementById("heightInput");

        // Get display elements
        const cdValue = document.getElementById("cdValue");
        const areaValue = document.getElementById("areaValue");
        const velocityValue = document.getElementById("velocityValue");
        const unitValue = document.getElementById("unitValue");
        const dragForceDisplay = document.getElementById("dragForce");
        const lengthValue = document.getElementById("lengthValue");
        const widthValue = document.getElementById("widthValue");
        const heightValue = document.getElementById("heightValue");

        // Function to calculate drag force per unit (Robot)
        function calculateDrag(Cd, A, v) {
            return 0.5 * Cd * rho * A * v ** 2;
        }

        // Function to calculate fouled drag coefficient based on fouling thickness
        function calculateFouledCd(Cd_clean, foulingThickness, maxFoulingThickness) {
            const foulingFactor = foulingThickness / maxFoulingThickness;  // Normalized fouling thickness (0 to 1)
            const Cd_biofouled = Cd_clean + (Cd_biofouledMax - Cd_clean) * foulingFactor;  // Linear increase
            return Math.min(Cd_biofouled, Cd_biofouledMax);  // Cap Cd at max fouled value
        }

        // Function to calculate the biofouling drag force using fouled Cd
        function calculateBiofoulingDragForce(Cd_clean, A, foulingThickness, v, maxFoulingThickness) {
            const Cd_fouled = calculateFouledCd(Cd_clean, foulingThickness, maxFoulingThickness);
            return calculateDrag(Cd_fouled, A, v);
        }

        // Initialize Chart.js
        const ctx = document.getElementById("dragChart").getContext("2d");
        let dragChart = new Chart(ctx, {
            type: "line",
            data: {
                labels: Array.from({ length: 365 }, (_, i) => i), // X-axis: Days from 0 to 365
                datasets: [
                    {
                        label: "Clean Ship Drag Force (N)",
                        data: [],
                        borderColor: "blue",
                        backgroundColor: "rgba(0, 0, 255, 0.2)",
                        fill: true,
                    },
                    {
                        label: "Clean Ship + Robot Drag Force (N)",
                        data: [],
                        borderColor: "green",
                        backgroundColor: "rgba(0, 255, 0, 0.2)",
                        fill: true,
                    },
                    {
                        label: "Clean Ship + Biofouling Drag Force (N)",
                        data: [],
                        borderColor: "red",
                        backgroundColor: "rgba(255, 0, 0, 0.2)",
                        fill: true,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        enabled: true,
                        mode: "nearest",
                        intersect: false,
                        callbacks: {
                            label: function (context) {
                                return `Total Drag Force: ${context.raw.toExponential(3)} N`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: "Time (Days)" },
                    },
                    y: {
                        title: { display: true, text: "Drag Force (N)" },
                        beginAtZero: false,
                        ticks: {
                            callback: function(value) {
                                return value.toExponential(3); // Display in scientific notation
                            }
                        }
                    }
                }
            }
        });

        // Function to update values and chart
        function updateSimulation() {
            // Get values from inputs
            const Cd_robot = parseFloat(cdSlider.value);
            const A_robot = parseFloat(areaSlider.value);
            const velocityKnots = parseFloat(velocitySlider.value);
            const units = parseInt(unitInput.value);
            const velocity = velocityKnots * 0.514444;  // Convert knots to m/s

            const length = parseFloat(lengthInput.value);
            const width = parseFloat(widthInput.value);
            const dragHeight = parseFloat(heightInput.value);

            // Update displayed values
            cdValue.textContent = Cd_robot.toFixed(2);
            areaValue.textContent = A_robot.toFixed(2);
            velocityValue.textContent = velocityKnots.toFixed(2);
            unitValue.textContent = units;
            lengthValue.textContent = length.toFixed(2);
            widthValue.textContent = width.toFixed(2);
            heightValue.textContent = dragHeight.toFixed(2);

            // Calculate ship's surface area (A_ship)
            const A_ship = length * width * dragHeight; // Front surface area of the ship

            // Calculate drag force for the robot
            const robotDragForce = calculateDrag(Cd_robot, A_robot, velocity) * units;

            // Calculate drag force for the ship (clean ship)
            const foulingThickness = maxFoulingThickness / (1 + Math.exp(-biofoulingRate * (new Date().getDay() - 180))); // Logistic growth of fouling over time
            const shipDragForce = calculateBiofoulingDragForce(Cd_clean, A_ship, foulingThickness, velocity, maxFoulingThickness);

            // Update chart data
            let cleanShipData = [];
            let robotWithShipData = [];
            let foulingShipData = [];

            for (let i = 0; i <= 365; i++) {
                const shipDrag = calculateBiofoulingDragForce(Cd_clean, A_ship, foulingThickness, velocity, maxFoulingThickness);
                cleanShipData.push(shipDrag);
                robotWithShipData.push(shipDrag + robotDragForce);
                foulingShipData.push(shipDrag + robotDragForce); // Add fouling to total drag force
            }

            dragChart.data.datasets[0].data = cleanShipData;
            dragChart.data.datasets[1].data = robotWithShipData;
            dragChart.data.datasets[2].data = foulingShipData;

            dragChart.update();
        }

        // Event listeners for sliders and input
        cdSlider.addEventListener("input", updateSimulation);
        areaSlider.addEventListener("input", updateSimulation);
        velocitySlider.addEventListener("input", updateSimulation);
        unitInput.addEventListener("input", updateSimulation);
        lengthInput.addEventListener("input", updateSimulation);
        widthInput.addEventListener("input", updateSimulation);
        heightInput.addEventListener("input", updateSimulation);

        // Initial update
        updateSimulation();
    </script>

</body>
</html>
